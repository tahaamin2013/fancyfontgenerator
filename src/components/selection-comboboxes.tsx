"use client"

import { useState } from "react"
import { Check, ChevronsUpDown } from "lucide-react"
import { cn } from "@/lib/utils"
import { Button } from "@/src/components/ui/button"
import { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from "@/src/components/ui/command"
import { Popover, PopoverContent, PopoverTrigger } from "@/src/components/ui/popover"

// Define the options for each category with Unicode characters
const options = {
  startingWrapper: [
    "(",
    "[",
    "{",
    "âŒ",
    "â•°",
    "â”Œ",
    "â•­",
    "á••",
    "á•¦",
    "á•™",
    "áƒš",
    "â”¬",
    "Â¯\\",
    "â•¯",
    "à² ",
    "â—‰",
    "âŠ™",
    "â—",
    "â—•",
    "â˜‰",
  ],
  startingEyebrow: ["Í¡", "Â°", "à² ", "â—‰", "âŠ™", "â—", "â—•", "â˜‰", "âŒ", "Â¬", "â•°", "â”Œ", "â•­", "á••", "á•¦", "á•™", "áƒš", "â”¬", "Â¯", "â•¯"],
  startingEye: [
    "Â°",
    "à² ",
    "â—‰",
    "âŠ™",
    "â—",
    "â—•",
    "â˜‰",
    "âŒ",
    "Â¬",
    "â•°",
    "â”Œ",
    "â•­",
    "á••",
    "á•¦",
    "á•™",
    "áƒš",
    "â”¬",
    "Â¯",
    "â•¯",
    "â—”",
    "â—‘",
    "â—’",
    "â—“",
    "â—",
    "â—",
    "â—‹",
    "â—¯",
    "âš«",
    "âšª",
    "ðŸ”´",
    "ðŸŸ ",
    "ðŸŸ¡",
    "ðŸŸ¢",
    "ðŸ”µ",
    "ðŸŸ£",
    "â­•",
    "âŒ",
    "âœ–",
    "âž•",
    "âž–",
    "âž—",
    "âœ”",
    "â˜‘",
    "âœ…",
    "âŽ",
    "ðŸ†š",
    "ðŸ“",
    "ðŸ“Œ",
    "ðŸ“Ž",
    "ðŸ”—",
    "â›“",
    "ðŸ”’",
    "ðŸ”“",
    "ðŸ”",
    "ðŸ”‘",
    "ðŸ—",
    "ðŸ”¨",
    "âš’",
    "ðŸ› ",
    "âš™",
    "ðŸ”§",
    "ðŸ”©",
    "âš¡",
    "ðŸ”¥",
    "ðŸ’§",
    "ðŸŒŠ",
    "â„",
    "â˜ƒ",
    "â›„",
    "â˜€",
    "ðŸŒž",
    "ðŸŒ",
    "ðŸŒ›",
    "ðŸŒœ",
    "ðŸŒš",
    "ðŸŒ•",
    "ðŸŒ–",
    "ðŸŒ—",
    "ðŸŒ˜",
    "ðŸŒ‘",
    "ðŸŒ’",
    "ðŸŒ“",
    "ðŸŒ”",
    "â­",
    "ðŸŒŸ",
    "ðŸ’«",
    "âœ¨",
    "â˜„",
    "ðŸ’¥",
    "ðŸ”†",
    "ðŸ”…",
    "ðŸ’¡",
    "ðŸ”¦",
    "ðŸ®",
    "ðŸ“±",
    "ðŸ“²",
    "ðŸ’»",
    "âŒ¨",
    "ðŸ–¥",
    "ðŸ–¨",
    "ðŸ–±",
    "ðŸ–²",
    "ðŸ’½",
    "ðŸ’¾",
    "ðŸ’¿",
    "ðŸ“€",
    "ðŸ“¼",
    "ðŸ“·",
    "ðŸ“¸",
    "ðŸ“¹",
    "ðŸŽ¥",
    "ðŸ“½",
    "ðŸŽž",
    "ðŸ“º",
    "ðŸ“»",
    "ðŸŽ™",
    "ðŸŽš",
    "ðŸŽ›",
    "â±",
    "â²",
    "â°",
    "ðŸ•°",
    "â³",
    "âŒ›",
    "ðŸ“¡",
    "ðŸ”‹",
    "ðŸ”Œ",
    "ðŸ’¡",
    "ðŸ”¦",
    "ðŸ•¯",
    "ðŸª”",
    "ðŸ§¯",
    "ðŸ›¢",
    "ðŸ’¸",
    "ðŸ’µ",
    "ðŸ’´",
    "ðŸ’¶",
    "ðŸ’·",
    "ðŸ’°",
    "ðŸ’³",
    "ðŸ’Ž",
    "âš–",
    "ðŸ§°",
    "ðŸ”—",
    "â›“",
    "ðŸ§²",
    "ðŸ”«",
    "ðŸ’£",
    "ðŸ§¨",
    "ðŸª“",
    "ðŸ”ª",
    "ðŸ—¡",
    "âš”",
    "ðŸ›¡",
    "ðŸš¬",
    "âš°",
    "âš±",
    "ðŸº",
    "ðŸ”®",
    "ðŸ“¿",
    "ðŸ§¿",
    "ðŸ’ˆ",
    "âš—",
    "ðŸ”­",
    "ðŸ”¬",
    "ðŸ•³",
    "ðŸ’Š",
    "ðŸ’‰",
    "ðŸ§¬",
    "ðŸ¦ ",
    "ðŸ§«",
    "ðŸ§ª",
    "ðŸŒ¡",
    "ðŸ§¹",
    "ðŸ§º",
    "ðŸ§»",
    "ðŸš½",
    "ðŸš°",
    "ðŸš¿",
    "ðŸ›",
    "ðŸ›€",
    "ðŸ§´",
    "ðŸ§·",
    "ðŸ§¸",
    "ðŸ§µ",
    "ðŸ§¶",
    "ðŸª¡",
    "ðŸ§¾",
    "ðŸ§®",
    "ðŸª†",
    "ðŸª…",
    "ðŸŽŠ",
    "ðŸŽ‰",
    "ðŸŽˆ",
    "ðŸŽ€",
    "ðŸŽ",
    "ðŸŽ—",
    "ðŸŽŸ",
    "ðŸŽ«",
    "ðŸŽ–",
    "ðŸ†",
    "ðŸ…",
    "ðŸ¥‡",
    "ðŸ¥ˆ",
    "ðŸ¥‰",
    "âš½",
    "âš¾",
    "ðŸ¥Ž",
    "ðŸ€",
    "ðŸ",
    "ðŸˆ",
    "ðŸ‰",
    "ðŸŽ¾",
    "ðŸ¥",
    "ðŸŽ³",
    "ðŸ",
    "ðŸ‘",
    "ðŸ’",
    "ðŸ¥",
    "ðŸ“",
    "ðŸ¸",
    "ðŸ¥Š",
    "ðŸ¥‹",
    "ðŸŽ½",
    "â›³",
    "â›·",
    "ðŸŽ¿",
    "ðŸ›·",
    "ðŸ¥Œ",
    "ðŸŽ¯",
    "ðŸª€",
    "ðŸª",
    "ðŸŽ±",
    "ðŸ”®",
    "ðŸª„",
    "ðŸ§¿",
    "ðŸŽ®",
    "ðŸ•¹",
    "ðŸŽ°",
    "ðŸŽ²",
    "ðŸ§©",
    "ðŸ§¸",
    "â™ ",
    "â™¥",
    "â™¦",
    "â™£",
    "â™Ÿ",
    "ðŸƒ",
    "ðŸ€„",
    "ðŸŽ´",
    "ðŸŽ­",
    "ðŸ–¼",
    "ðŸŽ¨",
    "ðŸ§µ",
    "ðŸ§¶",
    "ðŸª¡",
  ],
  nose: [
    "Ê–",
    "Íœ",
    "â€¿",
    "á´—",
    "Ï‰",
    "Â³",
    "Îµ",
    "Ð·",
    "áµ•",
    "â—¡",
    "â€¾",
    "âˆ€",
    "âˆ©",
    "âˆª",
    "âŒ’",
    "ï¸¶",
    "ï¸µ",
    "ï¸¿",
    "ï¹€",
    "âˆ©",
    "âˆª",
    "âŒ£",
    "âŒ¢",
    "ï¸º",
    "ï¸¹",
    "ï¸¸",
    "ï¸·",
    "ï¸¶",
    "ï¸µ",
    "ï¸´",
    "ï¸³",
    "ï¸²",
    "ï¸±",
    "ï¸°",
    "ï¸¯",
    "ï¸®",
    "ï¸­",
    "ï¸¬",
    "ï¸«",
    "ï¸ª",
    "ï¸©",
    "ï¸¨",
    "ï¸§",
    "ï¸¦",
    "ï¸¥",
    "ï¸¤",
    "ï¸£",
    "ï¸¢",
    "ï¸¡",
    "ï¸ ",
    "ï¸Ÿ",
    "ï¸ž",
    "ï¸",
    "ï¸œ",
    "ï¸›",
    "ï¸š",
    "ï¸™",
    "ï¸˜",
    "ï¸—",
    "ï¸–",
    "ï¸•",
    "ï¸”",
    "ï¸“",
    "ï¸’",
    "ï¸‘",
    "ï¸",
    "ï¸",
    "ï¸Ž",
    "ï¸",
    "ï¸Œ",
    "ï¸‹",
    "ï¸Š",
    "ï¸‰",
    "ï¸ˆ",
    "ï¸‡",
    "ï¸†",
    "ï¸…",
    "ï¸„",
    "ï¸ƒ",
    "ï¸‚",
    "ï¸",
    "ï¸€",
    "ï¹¿",
    "ï¹¾",
    "ï¹½",
    "ï¹¼",
    "ï¹»",
    "ï¹º",
    "ï¹¹",
    "ï¹¸",
    "ï¹·",
    "ï¹¶",
    "ï¹µ",
    "ï¹´",
    "ï¹³",
    "ï¹²",
    "ï¹±",
    "ï¹°",
    "ï¹¯",
    "ï¹®",
    "ï¹­",
    "ï¹¬",
    "ï¹«",
    "ï¹ª",
    "ï¹©",
    "ï¹¨",
    "ï¹§",
    "ï¹¦",
    "ï¹¥",
    "ï¹¤",
    "ï¹£",
    "ï¹¢",
    "ï¹¡",
    "ï¹ ",
    "ï¹Ÿ",
    "ï¹ž",
    "ï¹",
    "ï¹œ",
    "ï¹›",
    "ï¹š",
    "ï¹™",
    "ï¹˜",
    "ï¹—",
    "ï¹–",
    "ï¹•",
    "ï¹”",
    "ï¹“",
    "ï¹’",
    "ï¹‘",
    "ï¹",
    "ï¹",
    "ï¹Ž",
    "ï¹",
    "ï¹Œ",
    "ï¹‹",
    "ï¹Š",
    "ï¹‰",
    "ï¹ˆ",
    "ï¹‡",
    "ï¹†",
    "ï¹…",
    "ï¹„",
    "ï¹ƒ",
    "ï¹‚",
    "ï¹",
    "ï¹€",
  ],
  endingEyebrow: ["Í¡", "Â°", "à² ", "â—‰", "âŠ™", "â—", "â—•", "â˜‰", "âŒ", "Â¬", "â•°", "â”Œ", "â•­", "á••", "á•¦", "á•™", "áƒš", "â”¬", "Â¯", "â•¯"],
  endingEye: [
    "Â°",
    "à² ",
    "â—‰",
    "âŠ™",
    "â—",
    "â—•",
    "â˜‰",
    "âŒ",
    "Â¬",
    "â•°",
    "â”Œ",
    "â•­",
    "á••",
    "á•¦",
    "á•™",
    "áƒš",
    "â”¬",
    "Â¯",
    "â•¯",
    "â—”",
    "â—‘",
    "â—’",
    "â—“",
    "â—",
    "â—",
    "â—‹",
    "â—¯",
    "âš«",
    "âšª",
  ],
  endingWrapper: [")", "]", "}", "â•¯", "â•®", "â”", "â•¯", "á•—", "á•¤", "á•˜", "áƒš", "â”´", "/Â¯", "â•°", "à² ", "â—‰", "âŠ™", "â—", "â—•", "â˜‰"],
}

// Define the display names for each category
const categoryDisplayNames = {
  startingWrapper: "Starting Wrapper",
  startingEyebrow: "Starting Eyebrow",
  startingEye: "Starting Eye",
  nose: "Nose",
  endingEyebrow: "Ending Eyebrow",
  endingEye: "Ending Eye",
  endingWrapper: "Ending Wrapper",
}

type SelectionComboboxesProps = {
  onSelectionChange: (category: string, value: string) => void
}

export function SelectionComboboxes({ onSelectionChange }: SelectionComboboxesProps) {
  // State to track open state of each popover
  const [openStates, setOpenStates] = useState({
    startingWrapper: false,
    startingEyebrow: false,
    startingEye: false,
    nose: false,
    endingEyebrow: false,
    endingEye: false,
    endingWrapper: false,
  })

  // State to track the selected value for each category
  const [selectedValues, setSelectedValues] = useState({
    startingWrapper: "",
    startingEyebrow: "",
    startingEye: "",
    nose: "",
    endingEyebrow: "",
    endingEye: "",
    endingWrapper: "",
  })

  // Function to handle opening/closing a popover
  const toggleOpen = (category: string, isOpen: boolean) => {
    setOpenStates((prev) => ({
      ...prev,
      [category]: isOpen,
    }))
  }

  // Function to handle selection of an option
  const handleSelect = (category: string, value: string) => {
    setSelectedValues((prev) => ({
      ...prev,
      [category]: value,
    }))
    onSelectionChange(category, value)
    toggleOpen(category, false)
  }

  // Generate comboboxes for all categories
  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
      {Object.keys(options).map((category) => (
        <div key={category} className="flex flex-col space-y-1.5">
          <label htmlFor={category} className="text-sm font-medium text-zinc-300">
            {categoryDisplayNames[category as keyof typeof categoryDisplayNames]}
          </label>
          <Popover
            open={openStates[category as keyof typeof openStates]}
            onOpenChange={(open) => toggleOpen(category, open)}
          >
            <PopoverTrigger asChild>
              <Button
                variant="outline"
                role="combobox"
                aria-expanded={openStates[category as keyof typeof openStates]}
                className="justify-between bg-zinc-900 border-zinc-700 text-zinc-200 hover:bg-zinc-800 hover:text-white"
              >
                {selectedValues[category as keyof typeof selectedValues] ||
                  `Select ${categoryDisplayNames[category as keyof typeof categoryDisplayNames]}`}
                <ChevronsUpDown className="ml-2 h-4 w-4 shrink-0 opacity-50" />
              </Button>
            </PopoverTrigger>
            <PopoverContent className="p-0 bg-zinc-900 border-zinc-700 text-zinc-200">
              <Command className="bg-transparent">
                <CommandInput
                  placeholder={`Search ${categoryDisplayNames[category as keyof typeof categoryDisplayNames]}...`}
                  className="text-zinc-200"
                />
                <CommandList>
                  <CommandEmpty>No option found.</CommandEmpty>
                  <CommandGroup>
                    {options[category as keyof typeof options].map((option) => (
                      <CommandItem
                        key={option}
                        value={option}
                        onSelect={() => handleSelect(category, option)}
                        className="hover:bg-zinc-800"
                      >
                        <Check
                          className={cn(
                            "mr-2 h-4 w-4",
                            selectedValues[category as keyof typeof selectedValues] === option
                              ? "opacity-100"
                              : "opacity-0",
                          )}
                        />
                        {option}
                      </CommandItem>
                    ))}
                  </CommandGroup>
                </CommandList>
              </Command>
            </PopoverContent>
          </Popover>
        </div>
      ))}
    </div>
  )
}
